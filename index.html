<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Xtreme Mining – Diseño de Disparo por Tipo de Tiro</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>

<body>

<header class="header">
  <div class="logo">
    <div class="logo-text">
      <span class="logo-main">XTREME MINING</span>
      <span class="logo-sub">Sistema Profesional de Diseño de Disparos</span>
    </div>
  </div>
  <div class="credits">
    <strong>Creador:</strong> Bernardo Ojeda<br>
    Jefe de Innovación y Formación
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>Parámetros del Disparo</h2>

    <form id="form-disparo">
      <div class="form-row">
        <label for="contrato">Contrato</label>
        <input id="contrato" type="text" placeholder="Ej: 5010" required />
      </div>

      <div class="form-row">
        <label for="mina">Mina</label>
        <select id="mina">
          <option value="">Seleccionar...</option>
          <option value="Xtreme Andina">Xtreme Andina</option>
          <option value="Xtreme Teniente">Xtreme Teniente</option>
          <option value="Xtreme Chuquicamata">Xtreme Chuquicamata</option>
          <option value="Xtreme Carpetas">Xtreme Carpetas</option>
        </select>
      </div>

      <h3>Geometría de la Excavación</h3>

      <div class="form-row-group">
        <div class="form-row">
          <label for="ancho">Ancho (m)</label>
          <input id="ancho" type="number" step="0.01" value="5.20" />
        </div>
        <div class="form-row">
          <label for="alto">Alto (m)</label>
          <input id="alto" type="number" step="0.01" value="6.10" />
        </div>
        <div class="form-row">
          <label for="largo">Avance (m)</label>
          <input id="largo" type="number" step="0.01" value="3.80" />
        </div>
      </div>

      <h3>Burden y Espaciamiento</h3>

      <div class="form-row-group">
        <div class="form-row">
          <label for="diametro">Diámetro (mm)</label>
          <input id="diametro" type="number" step="1" value="51" />
        </div>

        <div class="form-row">
          <label for="modelo-burden">Modelo</label>
          <select id="modelo-burden">
            <option value="simple">Recomendado (B=0,60 / S=0,80)</option>
            <option value="roca">Por tipo de roca</option>
            <option value="manual">Manual</option>
          </select>
        </div>

        <div class="form-row">
          <label for="tipo-roca">Tipo de roca</label>
          <select id="tipo-roca">
            <option value="dura">Dura</option>
            <option value="muy-dura">Muy dura</option>
            <option value="media">Media</option>
            <option value="blanda">Blanda</option>
          </select>
        </div>
      </div>

      <div class="form-row-group">
        <div class="form-row">
          <label for="burden">Burden (m)</label>
          <input id="burden" type="number" step="0.01" value="0" />
        </div>

        <div class="form-row">
          <label for="espaciamiento">Espaciamiento (m)</label>
          <input id="espaciamiento" type="number" step="0.01" value="0" />
        </div>

        <div class="form-row">
          <label for="nperf">N° Perforaciones</label>
          <input id="nperf" type="number" readonly />
        </div>
      </div>

      <div class="form-row">
        <label for="obs">Observaciones</label>
        <textarea id="obs" rows="2"></textarea>
      </div>

      <button type="submit" class="btn-primary">
        Calcular y Registrar
      </button>
      <button id="btn-cancelar-edicion" type="button" class="btn-secondary" style="display:none;">
        Cancelar edición
      </button>

    </form>

    <div id="resultado" class="resultado"></div>

    <div class="malla-wrapper">
      <h3>Malla de Perforación (Vista Herradura)</h3>
      <canvas id="canvasMalla" width="420" height="260"></canvas>
    </div>
  </section>

  <section class="card">
    <h2>Explosivo por TIPO DE TIRO (Editable)</h2>

    <p style="font-size:12px;color:#9ca3af;">
      Ajusta aquí la carga unitaria por tiro en cada grupo.
      El sistema multiplicará × el número de tiros reales de cada tipo.
    </p>

    <table class="tabla-tiro">
      <thead>
        <tr>
          <th>Tipo de tiro</th>
          <th>N° tiros</th>
          <th>Emultex<br>(cart/tiro)</th>
          <th>Famecorte E-20<br>(cart/tiro)</th>
          <th>ANFO<br>(kg/m)</th>
        </tr>
      </thead>
      <tbody id="tablaTipoTiro"></tbody>
    </table>

    <h2 style="margin-top:20px;">Registro Histórico</h2>

    <div class="filters">
      <div class="form-row">
        <label for="filtro-mina">Filtrar por mina</label>
        <select id="filtro-mina">
          <option value="">Todas</option>
          <option value="Xtreme Andina">Xtreme Andina</option>
          <option value="Xtreme Teniente">Xtreme Teniente</option>
          <option value="Xtreme Chuquicamata">Xtreme Chuquicamata</option>
          <option value="Xtreme Carpetas">Xtreme Carpetas</option>
        </select>
      </div>

      <div class="form-row">
        <label for="filtro-contrato">Filtrar por contrato</label>
        <input id="filtro-contrato" type="text" />
      </div>

      <button id="btn-limpiar-filtros" class="btn-secondary">Limpiar</button>
      <button id="btn-export-excel" class="btn-secondary">Exportar Excel</button>
      <button id="btn-export-pdf" class="btn-secondary">Informe PDF</button>
      <button id="btn-malla-png" class="btn-secondary">PNG Malla</button>
      <button id="btn-qr" class="btn-secondary">QR Disparo</button>
      <button id="btn-eliminar" class="btn-secondary">Eliminar</button>
    </div>

    <div class="table-wrapper">
      <table id="tabla-registros">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Contrato</th>
            <th>Mina</th>
            <th>Sección</th>
            <th>Avance</th>
            <th>N° Tiros</th>
            <th>Volumen</th>
            <th>Fc</th>
            <th>Emultex (kg)</th>
            <th>E-20 (kg)</th>
            <th>ANFO (kg)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="charts">
      <div class="chart-card">
        <h3>Carga por tipo de explosivo</h3>
        <canvas id="chartExplosivos"></canvas>
      </div>
      <div class="chart-card">
        <h3>Factor de carga por disparo</h3>
        <canvas id="chartFc"></canvas>
      </div>
    </div>
  </section>

</main>

<footer class="footer">
  © <span id="year"></span> Xtreme Mining · Sistema de Diseño de Disparos.
</footer>

<script src="app.js"></script>
</body>
</html>
